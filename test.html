<button id="startRecording">Start Recording</button>
<button id="stopRecording" disabled>Stop Recording</button>
<textarea id="transcript" rows="10" cols="50" placeholder="Transcription will appear here..."></textarea>

<script>
let mediaRecorder;
let audioChunks = [];
let isRecording = false;
let intervalId;
const API_KEY = "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";

document.getElementById('startRecording').addEventListener('click', async () => {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    isRecording = true;

    mediaRecorder.ondataavailable = event => {
        if (event.data.size > 0) {
            sendToGroqAPI(event.data);
        }
    };

    mediaRecorder.start();

    // Capture & send audio every 5 seconds
    intervalId = setInterval(() => {
        if (isRecording) {
            mediaRecorder.requestData(); // Get current audio data
        }
    }, 5000);

    document.getElementById('startRecording').disabled = true;
    document.getElementById('stopRecording').disabled = false;
});

document.getElementById('stopRecording').addEventListener('click', () => {
    isRecording = false;
    clearInterval(intervalId);
    mediaRecorder.stop();

    document.getElementById('startRecording').disabled = false;
    document.getElementById('stopRecording').disabled = true;
});

async function sendToGroqAPI(audioBlob) {
    const formData = new FormData();
    formData.append('file', audioBlob, 'audio.webm');
    formData.append('model', 'whisper-large-v3');

    try {
        const response = await fetch("https://api.groq.com/openai/v1/audio/transcriptions", {
            method: "POST",
            headers: { "Authorization": `Bearer ${API_KEY}` },
            body: formData
        });

        const data = await response.json();
        if (data.text) {
            document.getElementById('transcript').value += data.text + "\n";
        }
    } catch (error) {
        console.error("Transcription Error:", error);
    }
}
</script>
