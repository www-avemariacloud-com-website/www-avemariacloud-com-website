<!DOCTYPE html>
<html>
<head>
    <title>Webpage Content v3.1</title>
    <style>
        .error-message {
            color: red;
            padding: 20px;
            text-align: center;
        }
        .loading-message {
            color: #777;
            padding: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="input_data" style="visibility: hidden">
        <div class="loading-message"></div>
    </div>
    <div id="plain_text"></div>
</body>
</html>

<script>

function extractVisibleText(htmlString) {
    // Create a new DOM parser
    let parser = new DOMParser();
    let doc = parser.parseFromString(htmlString, "text/html");

    // Remove all script and style elements
    doc.querySelectorAll("script, style, meta, link, head, title").forEach(el => el.remove());

    // Get the visible text
    return doc.body.innerText.trim();
}

function processInputData() {
    var inputHTML = document.getElementById("input_data").innerHTML
    
    var plainText = extractVisibleText(inputHTML);
    
    document.getElementById("plain_text").innerHTML = plainText;
}

const targetNode = document.getElementById("input_data");

const observer = new MutationObserver((mutationsList) => {
    for (const mutation of mutationsList) {
        if (mutation.type === "childList" || mutation.type === "characterData") {
            processInputData();
        }
    }
});

const config = { childList: true, characterData: true, subtree: true };

if (targetNode) {
    observer.observe(targetNode, config);
}

</script>
