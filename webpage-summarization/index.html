<!DOCTYPE html>
<html>
<head>
    <title>Web Page Content v3.7</title>
    <style>
        .error-message {
            color: red;
            padding: 20px;
            text-align: center;
        }
        .loading-message {
            color: #777;
            padding: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="input_data" style="visibility: hidden"></div>
    <div id="plain_text">Loading...</div>
</body>
</html>

<script>

function extractVisibleText(htmlString) {
    // Create a new DOM parser
    let parser = new DOMParser();
    let doc = parser.parseFromString(htmlString, "text/html");

    // Remove all script and style elements
    doc.querySelectorAll("script, style, meta, link, head, title").forEach(el => el.remove());

    // Get the visible text
    return doc.body.innerText.trim();
}

function processInputData() {
    var inputHTML = document.getElementById("input_data").innerHTML
    
    document.getElementById("input_data").innerHTML = "";
    
    var plainText = extractVisibleText(inputHTML);
    
    plainText = plainText.replace(/\n/g, `
`);

    document.getElementById("plain_text").innerHTML = plainText;
}

const interval = setInterval(() => {
    if (document.getElementById("input_data").innerHTML != "") {
        console.log("Input detected!");
        processInputData();
        clearInterval(interval); // Stop checking
    } else {
        console.log("Checking...");
    }
}, 100);


</script>
